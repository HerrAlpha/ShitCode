@{
    ViewData["Title"] = "Telegram Bot Integration";
    Layout = "_DocsLayout";
}

<div class="prose max-w-none">
    <h1>Telegram Bot Integration</h1>
    
    <p class="lead">
        Configure your ErrorLogDashboard to send error notifications to Telegram chats via bot webhooks.
    </p>

    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 my-6">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-blue-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                </svg>
            </div>
            <div class="ml-3">
                <p class="text-sm text-blue-700">
                    Webhook notifications appear as formatted Markdown messages in your Telegram chat with error details.
                </p>
            </div>
        </div>
    </div>

    <h2>Step 1: Create a Telegram Bot</h2>
    
    <ol>
        <li>Open Telegram and search for <strong>@@BotFather</strong></li>
        <li>Start a chat with BotFather and send the command: <code>/newbot</code></li>
        <li>Follow the prompts:
            <ul>
                <li>Choose a display name (e.g., "ShitCode Error Notifications")</li>
                <li>Choose a unique username ending in "bot" (e.g., "shitcode_errors_bot")</li>
            </ul>
        </li>
        <li>BotFather will provide you with a <strong>Bot Token</strong>. Save this securely!</li>
    </ol>

    <p>Your bot token will look like:</p>
    <pre><code>1234567890:ABCdefGHIjklMNOpqrsTUVwxyz123456789</code></pre>

    <h2>Step 2: Get Your Chat ID</h2>

    <p>You need to get the chat ID where the bot will send messages:</p>

    <h3>For Personal Chat:</h3>
    <ol>
        <li>Search for your bot username in Telegram</li>
        <li>Start a chat and send any message (e.g., "/start")</li>
        <li>Open this URL in your browser (replace <code>BOT_TOKEN</code> with your actual token):
            <pre><code>https://api.telegram.org/bot&lt;BOT_TOKEN&gt;/getUpdates</code></pre>
        </li>
        <li>Look for <code>"chat":{"id":123456789}</code> in the JSON response</li>
        <li>Save this chat ID</li>
    </ol>

    <h3>For Group Chat:</h3>
    <ol>
        <li>Add your bot to the group</li>
        <li>Send a message in the group mentioning the bot</li>
        <li>Use the same <code>/getUpdates</code> URL method above</li>
        <li>Group chat IDs are usually negative numbers (e.g., -123456789)</li>
    </ol>

    <h2>Step 3: Create Webhook URL</h2>

    <p>The webhook URL follows this format:</p>
    <pre><code>https://api.telegram.org/bot&lt;BOT_TOKEN&gt;/sendMessage?chat_id=&lt;CHAT_ID&gt;</code></pre>

    <p><strong>Example:</strong></p>
    <pre><code>https://api.telegram.org/bot1234567890:ABCdefGHIjklMNOpqrsTUVwxyz/sendMessage?chat_id=123456789</code></pre>

    <h2>Step 4: Configure Webhook in ErrorLogDashboard</h2>

    <ol>
        <li>Navigate to your project in the ErrorLogDashboard</li>
        <li>Click on <strong>Webhooks</strong> or <strong>Configure Webhooks</strong></li>
        <li>Fill in the webhook form:
            <ul>
                <li><strong>Name:</strong> Telegram Notifications</li>
                <li><strong>Webhook URL:</strong> Paste the Telegram webhook URL from Step 3</li>
                <li><strong>Webhook Type:</strong> Select <strong>Telegram</strong> from the dropdown</li>
                <li><strong>Secret Token:</strong> Leave empty (not used for Telegram)</li>
            </ul>
        </li>
        <li>Click <strong>Add Webhook</strong></li>
    </ol>

    <h2>Step 5: Test Your Webhook</h2>

    <p>You can test the webhook connection before saving:</p>
    <ol>
        <li>After entering the Telegram webhook URL, click <strong>Test Connection</strong></li>
        <li>Check your Telegram chat for a test message</li>
        <li>If successful, you'll see a confirmation message</li>
    </ol>

    <h2>Telegram Message Format</h2>

    <p>When an error occurs, your Telegram chat will receive a formatted message containing:</p>

    <ul>
        <li><strong>Header:</strong> ðŸš¨ New Error Detected</li>
        <li><strong>Error Message:</strong> The error message text</li>
        <li><strong>Status:</strong> Current error status (Open/InProgress/Resolved)</li>
        <li><strong>Error ID:</strong> Unique identifier for tracking</li>
        <li><strong>Timestamp:</strong> When the error occurred (UTC)</li>
        <li><strong>Summary:</strong> AI-generated summary (if available)</li>
        <li><strong>Stack Trace:</strong> Formatted in code block</li>
    </ul>

    <h3>Example Telegram Message</h3>

    <div class="bg-gray-100 p-4 rounded-lg my-4 font-mono text-sm">
        <p><strong>ðŸš¨ New Error Detected</strong></p>
        <p class="mt-2"><strong>Error Message:</strong> Object reference not set to an instance of an object</p>
        <p><strong>Status:</strong> Open</p>
        <p><strong>Error ID:</strong> <code>a1b2c3d4-e5f6-7890-abcd-ef1234567890</code></p>
        <p><strong>Time:</strong> 2025-12-10 15:23:31 UTC</p>
        <p class="mt-2"><strong>Summary:</strong> NullReferenceException in user service</p>
        <p class="mt-2"><strong>Stack Trace:</strong></p>
        <pre class="bg-gray-900 text-gray-100 p-2 rounded mt-1">at MyApp.Service.GetUser(Int32 id)
at MyApp.Controller.Index()
...</pre>
        <p class="mt-2 text-sm italic">ShitCode Error Dashboard</p>
    </div>

    <h2>Troubleshooting</h2>

    <h3>Webhook test fails</h3>
    <ul>
        <li>Verify the bot token is correct and complete</li>
        <li>Ensure the chat ID is correct (negative for groups)</li>
        <li>Make sure you selected "Telegram" as the webhook type</li>
        <li>Check that the bot hasn't been blocked or removed from the chat</li>
        <li>Verify the URL format matches exactly as shown in Step 3</li>
    </ul>

    <h3>Bot doesn't send messages to group</h3>
    <ul>
        <li>Ensure the bot has been added to the group</li>
        <li>Check that the bot has permission to send messages</li>
        <li>Verify you're using the correct (negative) chat ID for the group</li>
        <li>Some groups require admin permissions for bots to post</li>
    </ul>

    <h3>Messages appear but formatting is broken</h3>
    <ul>
        <li>This is normal - Telegram uses Markdown formatting</li>
        <li>Special characters in error messages may affect formatting</li>
        <li>The webhook type must be set to "Telegram" for proper formatting</li>
    </ul>

    <h2>Best Practices</h2>

    <ul>
        <li>Create different bots for different environments (production, staging, development)</li>
        <li>Use dedicated groups/channels for error notifications to avoid spam in main chats</li>
        <li>Keep your bot token secure - never commit it to version control</li>
        <li>Consider using Telegram channels for one-way notifications</li>
        <li>Set up notification filters in Telegram to manage alert volume</li>
    </ul>

    <h2>Using Telegram Channels (Advanced)</h2>

    <p>For broadcast-style notifications:</p>
    <ol>
        <li>Create a Telegram channel</li>
        <li>Add your bot as an administrator</li>
        <li>Get the channel ID (starts with -100)</li>
        <li>Use the channel ID in your webhook URL</li>
    </ol>

    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 my-6">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
            </div>
            <div class="ml-3">
                <p class="text-sm text-yellow-700">
                    <strong>Security Note:</strong> Keep your bot token private! Anyone with the token can send messages as your bot.
                </p>
            </div>
        </div>
    </div>

    <div class="bg-green-50 border-l-4 border-green-400 p-4 my-6">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-green-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
            </div>
            <div class="ml-3">
                <p class="text-sm text-green-700">
                    <strong>Pro Tip:</strong> Create a dedicated "Errors" channel and set it to silent mode to avoid constant notifications while still having a searchable error log.
                </p>
            </div>
        </div>
    </div>

    <h2>Next Steps</h2>

    <ul>
        <li><a asp-controller="Docs" asp-action="Discord">Set up Discord notifications</a></li>
        <li><a asp-controller="Docs" asp-action="Index">View all integration guides</a></li>
        <li><a asp-controller="Dashboard" asp-action="Index">Return to Dashboard</a></li>
    </ul>
</div>
